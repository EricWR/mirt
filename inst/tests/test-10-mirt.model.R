context('mirt.model')

test_that('syntax', {
    data <- expand.table(LSAT7)        
    model1 <- mirt.model('F = 1-5')
    model2 <- mirt.model('F = 1-5
                   CONSTRAIN = (1,2,3-5,a1)')
    model3 <- mirt.model('F = 1-5
                   CONSTRAIN = (2,3-5,a1)
                   PRIOR = (2,3-5, a1, lnorm, .2, .2), (1, d, norm, 0, 2)')
    model4 <- mirt.model('F = 1-5
                   CONSTRAIN = (1-2, d)        
                   CONSTRAINB = (2-4,5,a1), (1, a1)
                   PRIOR = (1-5, d, norm, 0, 2)')
    model5 <- mirt.model('F = 1-5
                   CONSTRAIN = (1-5, d, male)        
                   CONSTRAINB = (1-4,5,a1)
                   PRIOR = (1-5, d, norm, 0, 2, female)')
    model6 <- mirt.model('F1 = 1-2
                         F2 = 3-5
                         CONSTRAIN = (3-5, a2), (1-2, a1)
                         COV = F1*F2')        

    set.seed(1234)
    group <- sample(c('male', 'female'), 1000, TRUE)
    
    mod1 <- mirt(data, model1, verbose=FALSE, calcNull=FALSE)
    mod2 <- mirt(data, model2, verbose=FALSE, calcNull=FALSE)
    mod3 <- mirt(data, model3, verbose=FALSE, calcNull=FALSE)
    mod6 <- mirt(data, model6, verbose=FALSE, calcNull=FALSE)
    mod4 <- multipleGroup(data, model4, group=group, verbose = FALSE)
    mod5 <- multipleGroup(data, model5, group=group, verbose = FALSE)
    
    expect_equal(mod2values(mod1)$value, c(0.987973787231699, 1.85608912732841, 0, 1, 1.08103954211169, 0.808007534786952, 0, 1, 1.70595475896956, 1.80426768080187, 0, 1, 0.765076394253259, 0.486005938565521, 0, 1, 0.735771996169788, 1.85448564531374, 0, 1, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod2)$value, c(1.01052705474606, 1.86793304554809, 0, 1, 1.01052705474606, 0.790899504740889, 0, 1, 1.01052705474606, 1.46073200902294, 0, 1, 1.01052705474606, 0.521457445159032, 0, 1, 1.01052705474606, 1.99261823763434, 0, 1, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod3)$value, c(1.10784174676958, 1.91239633478765, 0, 1, 1.04684043398884, 0.797880409701628, 0, 1, 1.04684043398884, 1.47310584064986, 0, 1, 1.04684043398884, 0.526104887330641, 0, 1, 1.04684043398884, 2.00877254688793, 0, 1, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod4)$value, c(0.632433399913566, 1.49702480309375, 0, 1, 2.96489599420371, 1.49702480309375, 0, 1, 1.18479364102936, 1.64385960781437, 0, 1, 0.559375717878399, 0.54637999600046, 0, 1, 0.50324865634891, 1.69989452992446, 0, 1, 0, 1, 0.632433399913566, 1.72304351110227, 0, 1, 2.96489599420371, 1.72304351110227, 0, 1, 1.18479364102936, 1.49301751792476, 0, 1, 0.559375717878399, 0.411003389624152, 0, 1, 0.50324865634891, 1.84027629606117, 0, 1, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod5)$value, c(0.737129810199611, 1.35704119053397, 0, 1, 1.48519999159597, 1.35704119053397, 0, 1, 1.05934894888508, 1.35704119053397, 0, 1, 1.27305192361326, 1.35704119053397, 0, 1, 0.471202346227738, 1.35704119053397, 0, 1, 0, 1, 0.737129810199611, 1.86332826252524, 0, 1, 1.48519999159597, 0.949840930239808, 0, 1, 1.05934894888508, 1.39297931077557, 0, 1, 1.27305192361326, 0.47295678994725, 0, 1, 0.471202346227738, 1.81137838246491, 0, 1, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod6)$value, c(1.09030829179912, 0, 1.91140892885227, 0, 1, 1.09030829179912, 0, 0.810348391277771, 0, 1, 0, 1.01018157535737, 1.46075737389013, 0, 1, 0, 1.01018157535737, 0.521336706621957, 0, 1, 0, 1.01018157535737, 1.99270562102773, 0, 1, 0, 0, 1, 0.911175181181757, 1),
                 tollerance = 1e-2)
    
})

