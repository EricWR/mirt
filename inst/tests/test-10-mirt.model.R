context('mirt.model')

test_that('syntax', {
    data <- expand.table(LSAT7)        
    model1 <- mirt.model('F = 1-5')
    model2 <- mirt.model('F = 1-5
                   CONSTRAIN = (1,2,3-5,a1)')
    model3 <- mirt.model('F = 1-5
                   CONSTRAIN = (2,3-5,a1)
                   PRIOR = (2,3-5, a1, lnorm, .2, .2), (1, d, norm, 0, 2)')
    model4 <- mirt.model('F = 1-5
                   CONSTRAIN = (1-2, d)        
                   CONSTRAINB = (2-4,5,a1), (1, a1)
                   PRIOR = (1-5, d, norm, 0, 2)')
    model5 <- mirt.model('F = 1-5
                   CONSTRAIN = (1-5, d, male)        
                   CONSTRAINB = (1-4,5,a1)
                   PRIOR = (1-5, d, norm, 0, 2, female)')
    model6 <- mirt.model('F1 = 1-2
                         F2 = 3-5
                         CONSTRAIN = (3-5, a2), (1-2, a1)
                         COV = F1*F2')        

    set.seed(1234)
    group <- sample(c('male', 'female'), 1000, TRUE)
    
    mod1 <- mirt(data, model1, verbose=FALSE, calcNull=FALSE)
    mod2 <- mirt(data, model2, verbose=FALSE, calcNull=FALSE)
    mod3 <- mirt(data, model3, verbose=FALSE, calcNull=FALSE)
    mod6 <- mirt(data, model6, verbose=FALSE, calcNull=FALSE)
    mod4 <- multipleGroup(data, model4, group=group, verbose = FALSE)
    mod5 <- multipleGroup(data, model5, group=group, verbose = FALSE)
    
    expect_equal(mod2values(mod1)$value, c(0.987973787231699, 1.85608912732841, -999, 999, 1.08103954211169, 0.808007534786952, -999, 999, 1.70595475896956, 1.80426768080187, -999, 999, 0.765076394253259, 0.486005938565521, -999, 999, 0.735771996169788, 1.85448564531374, -999, 999, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod2)$value, c(1.01111513934972, 1.86802748564579, -999, 999, 1.01111513934972, 0.790897239396861, -999, 999, 1.01111513934972, 1.46079530751606, -999, 999, 1.01111513934972, 0.521423471712451, -999, 999, 1.01111513934972, 1.99272073339461, -999, 999, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod3)$value, c(1.10831645804601, 1.9127011792624, -999, 999, 1.04683272827073, 0.797849358440488, -999, 999, 1.04683272827073, 1.47307565465554, -999, 999, 1.04683272827073, 0.526075008433534, -999, 999, 1.04683272827073, 2.00873580066532, -999, 999, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod4)$value, c(0.632518320588776, 1.49752331478241, -999, 999, 2.9693752664154, 1.49752331478241, -999, 999, 1.18426208106561, 1.64344488524556, -999, 999, 0.558827919623084, 0.546217870860519, -999, 999, 0.502789164799132, 1.69965272397503, -999, 999, 0, 1, 0.632518320588776, 1.72371244683897, -999, 999, 2.9693752664154, 1.72371244683897, -999, 999, 1.18426208106561, 1.49261502616763, -999, 999, 0.558827919623084, 0.410858999316165, -999, 999, 0.502789164799132, 1.84002441333185, -999, 999, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod5)$value, c(0.736939370750504, 1.35702137831092, -998.999999999999, 998.999999999999, 1.48715710231537, 1.35702137831092, -998.999999999999, 998.999999999999, 1.05948438354295, 1.35702137831092, -998.999999999999, 998.999999999999, 1.27156753043142, 1.35702137831092, -998.999999999999, 998.999999999999, 0.47109517098747, 1.35702137831092, -998.999999999999, 998.999999999999, 0, 1, 0.736939370750504, 1.86322971635309, -998.999999999999, 998.999999999999, 1.48715710231537, 0.950391259545354, -998.999999999999, 998.999999999999, 1.05948438354295, 1.39300860969661, -998.999999999999, 998.999999999999, 1.27156753043142, 0.472735246414148, -998.999999999999, 998.999999999999, 0.47109517098747, 1.81133491520632, -998.999999999999, 998.999999999999, 0, 1),
                 tollerance = 1e-2)
    expect_equal(mod2values(mod6)$value, c(1.08870613475712, 0, 1.91040161760082, -999, 999, 1.08870613475712, 0, 0.809911793558514, -999, 999, 0, 1.00959164163015, 1.46046545581799, -999, 999, 0, 1.00959164163015, 0.521230327014584, -999, 999, 0, 1.00959164163015, 1.9923125279093, -999, 999, 0, 0, 1, 0.913256034174221, 1),
                 tollerance = 1e-2)
    
})

