<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract Empirical Estimating Functions — estfun.AllModelClass • mirt</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract Empirical Estimating Functions — estfun.AllModelClass" />
<meta property="og:description" content="A function for extracting the empirical estimating functions of a fitted
mirt, multipleGroup or bfactor
model. This is the derivative of the log-likelihood with respect to the
parameter vector, evaluated at the observed (case-wise) data. In other
words, this function returns the case-wise scores, evaluated at the fitted
model parameters. Currently, models fitted via the EM or BL
method are supported. For the computations, the internal Theta grid of
the model is being used which was already used during the estimation of
the model itself along with its matching normalized density." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mirt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.32.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/mirt-vignettes.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/philchalmers/mirt/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract Empirical Estimating Functions</h1>
    <small class="dont-index">Source: <a href='https://github.com/philchalmers/mirt/blob/master/R/estfun.R'><code>R/estfun.R</code></a></small>
    <div class="hidden name"><code>estfun.AllModelClass.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A function for extracting the empirical estimating functions of a fitted
<code><a href='mirt.html'>mirt</a></code>, <code><a href='multipleGroup.html'>multipleGroup</a></code> or <code><a href='bfactor.html'>bfactor</a></code>
model. This is the derivative of the log-likelihood with respect to the
parameter vector, evaluated at the observed (case-wise) data. In other
words, this function returns the case-wise scores, evaluated at the fitted
model parameters. Currently, models fitted via the <code>EM</code> or <code>BL</code>
method are supported. For the computations, the internal <code>Theta</code> grid of
the model is being used which was already used during the estimation of
the model itself along with its matching normalized density.</p>
    </div>

    <pre class="usage"><span class='fu'>estfun.AllModelClass</span><span class='op'>(</span>
  <span class='va'>x</span>,
  weights <span class='op'>=</span> <span class='fu'><a href='extract.mirt.html'>extract.mirt</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"survey.weights"</span><span class='op'>)</span>,
  centering <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a fitted model object of class <code>SingleGroupClass</code> or
<code>MultipleGroupClass</code></p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>by default, the <code>survey.weights</code> which were (optionally)
specified when fitting the model are included to calculate the scores.
If specified by the user, this should be a numeric vector of length equal
to the total sample size. Note that if not all cases were weighted equally
when fitting the model, the weights must be corrected by taking their
square root if the scores are being used to compute the outer product of
gradients (OPG) estimate of the variance-covariance matrix (see examples
below).</p></td>
    </tr>
    <tr>
      <th>centering</th>
      <td><p>a boolean variable that allows the centering of the case-wise
scores (i.e., setting their expected values to 0). If the case-wise scores were
obtained from maximum likelihood estimates, this setting does not affect the result.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An n x k matrix corresponding to n observations and k parameters</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='mirt.html'>mirt</a></code>, <code><a href='multipleGroup.html'>multipleGroup</a></code>,
  <code><a href='bfactor.html'>bfactor</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Lennart Schneider <a href='mailto:lennart.sch@web.de'>lennart.sch@web.de</a>; centering argument contributed by Rudolf Debelak (<a href='mailto:rudolf.debelak@psychologie.uzh.ch'>rudolf.debelak@psychologie.uzh.ch</a>)</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># \donttest{</span>
<span class='co'># fit a 2PL on the LSAT7 data and get the scores</span>
<span class='va'>mod1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mirt.html'>mirt</a></span><span class='op'>(</span><span class='fu'><a href='expand.table.html'>expand.table</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>)</span>, <span class='fl'>1</span>, SE <span class='op'>=</span> <span class='cn'>TRUE</span>, SE.type <span class='op'>=</span> <span class='st'>"crossprod"</span><span class='op'>)</span>
<span class='va'>sc1</span> <span class='op'>&lt;-</span> <span class='fu'>estfun.AllModelClass</span><span class='op'>(</span><span class='va'>mod1</span><span class='op'>)</span>
<span class='co'># get the gradient</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>sc1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          a1.1           d.2          a1.5           d.6          a1.9 
#&gt; -2.477599e-03 -1.749067e-03  8.292776e-05 -1.521604e-03  1.198404e-02 
#&gt;          d.10         a1.13          d.14         a1.17          d.18 
#&gt;  6.498261e-03 -2.188203e-03  4.417929e-03 -8.004879e-04 -5.566575e-04 </div><div class='input'><span class='co'># calculate the OPG estimate of the variance-covariance matrix "by hand"</span>
<span class='va'>vc1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span><span class='op'>(</span><span class='va'>mod1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>sc1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/chol2inv.html'>chol2inv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chol.html'>chol</a></span><span class='op'>(</span><span class='va'>vc1</span><span class='op'>)</span><span class='op'>)</span>, check.attributes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># fit a multiple group 2PL and do the same as above</span>
<span class='va'>group</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"G1"</span>, <span class='st'>"G2"</span><span class='op'>)</span>, <span class='fl'>500</span><span class='op'>)</span>
<span class='va'>mod2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='multipleGroup.html'>multipleGroup</a></span><span class='op'>(</span><span class='fu'><a href='expand.table.html'>expand.table</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='va'>group</span>, SE <span class='op'>=</span> <span class='cn'>TRUE</span>,
  SE.type <span class='op'>=</span> <span class='st'>"crossprod"</span><span class='op'>)</span>
<span class='va'>sc2</span> <span class='op'>&lt;-</span> <span class='fu'>estfun.AllModelClass</span><span class='op'>(</span><span class='va'>mod2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>sc2</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          a1.1           d.2          a1.5           d.6          a1.9 
#&gt; -3.118728e-04 -2.982410e-03 -2.735485e-04 -6.118069e-04  7.440279e-03 
#&gt;          d.10         a1.13          d.14         a1.17          d.18 
#&gt;  7.274125e-03 -9.423217e-04 -3.379603e-04  6.496281e-04 -1.868471e-03 
#&gt;         a1.23          d.24         a1.27          d.28         a1.31 
#&gt; -1.197098e-04 -4.435649e-04 -2.378475e-05  1.458023e-04  6.403262e-04 
#&gt;          d.32         a1.35          d.36         a1.39          d.40 
#&gt;  1.212925e-03 -1.443583e-04  4.381246e-05  4.279434e-04 -9.488836e-04 </div><div class='input'><span class='va'>vc2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span><span class='op'>(</span><span class='va'>mod2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>sc2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/chol2inv.html'>chol2inv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chol.html'>chol</a></span><span class='op'>(</span><span class='va'>vc2</span><span class='op'>)</span><span class='op'>)</span>, check.attributes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># fit a bifactor model with 2 specific factors and do the same as above</span>
<span class='va'>mod3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='bfactor.html'>bfactor</a></span><span class='op'>(</span><span class='fu'><a href='expand.table.html'>expand.table</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>, SE <span class='op'>=</span> <span class='cn'>TRUE</span>,
  SE.type <span class='op'>=</span> <span class='st'>"crossprod"</span><span class='op'>)</span>
<span class='va'>sc3</span> <span class='op'>&lt;-</span> <span class='fu'>estfun.AllModelClass</span><span class='op'>(</span><span class='va'>mod3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>sc3</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          a1.1          a3.3           d.4          a1.7          a3.9 
#&gt;  0.0018172801  0.0007522911  0.0008693077  0.0026167974 -0.0065562618 
#&gt;          d.10         a1.13         a2.14          d.16         a1.19 
#&gt;  0.0010184719  0.0002582749 -0.0123565804  0.0003107030 -0.0001820340 
#&gt;         a2.20          d.22         a1.25         a3.27          d.28 
#&gt; -0.0048417996  0.0020931538 -0.0005721500 -0.0060778033 -0.0028105998 </div><div class='input'><span class='va'>vc3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span><span class='op'>(</span><span class='va'>mod3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>sc3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/chol2inv.html'>chol2inv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chol.html'>chol</a></span><span class='op'>(</span><span class='va'>vc3</span><span class='op'>)</span><span class='op'>)</span>, check.attributes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># fit a 2PL not weighting all cases equally</span>
<span class='va'>survey.weights</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>$</span><span class='va'>freq</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>$</span><span class='va'>freq</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>survey.weights</span> <span class='op'>&lt;-</span> <span class='va'>survey.weights</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>survey.weights</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>$</span><span class='va'>freq</span><span class='op'>)</span>
<span class='va'>mod4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mirt.html'>mirt</a></span><span class='op'>(</span><span class='fu'><a href='expand.table.html'>expand.table</a></span><span class='op'>(</span><span class='va'>LSAT7</span><span class='op'>)</span>, <span class='fl'>1</span>, SE <span class='op'>=</span> <span class='cn'>TRUE</span>, SE.type <span class='op'>=</span> <span class='st'>"crossprod"</span>,
  survey.weights <span class='op'>=</span> <span class='va'>survey.weights</span><span class='op'>)</span>
<span class='va'>sc4</span> <span class='op'>&lt;-</span> <span class='fu'>estfun.AllModelClass</span><span class='op'>(</span><span class='va'>mod4</span>,
  weights <span class='op'>=</span> <span class='fu'><a href='extract.mirt.html'>extract.mirt</a></span><span class='op'>(</span><span class='va'>mod4</span>, <span class='st'>"survey.weights"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># get the gradient</span>
<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>sc4</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          a1.1           d.2          a1.5           d.6          a1.9 
#&gt; -0.0067330450 -0.0001045753  0.0019680853  0.0007675188  0.0088929479 
#&gt;          d.10         a1.13          d.14         a1.17          d.18 
#&gt;  0.0012985459  0.0016433039 -0.0008952128 -0.0071939497 -0.0031136208 </div><div class='input'><span class='co'># to calculate the OPG estimate of the variance-covariance matrix "by hand",</span>
<span class='co'># the weights must be adjusted by taking their square root</span>
<span class='va'>sc4_crp</span> <span class='op'>&lt;-</span> <span class='fu'>estfun.AllModelClass</span><span class='op'>(</span><span class='va'>mod4</span>,
  weights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='extract.mirt.html'>extract.mirt</a></span><span class='op'>(</span><span class='va'>mod4</span>, <span class='st'>"survey.weights"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>vc4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/vcov.html'>vcov</a></span><span class='op'>(</span><span class='va'>mod4</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/crossprod.html'>crossprod</a></span><span class='op'>(</span><span class='va'>sc4_crp</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/chol2inv.html'>chol2inv</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/chol.html'>chol</a></span><span class='op'>(</span><span class='va'>vc4</span><span class='op'>)</span><span class='op'>)</span>, check.attributes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Phil Chalmers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


